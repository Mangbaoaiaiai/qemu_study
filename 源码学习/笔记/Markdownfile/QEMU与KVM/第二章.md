# QEMU基本组件
## 1.qemu事件循环机制
 - fd（文件描述符）：
  是进程对打开文件的抽象，它是操作系统为每个打开的文件分配的句柄，用于在进程中访问文件。
    > fcb（进程控制块）：是文件系统层面的数据结构，存储文件的详细信息，描述文件的物理存储信息。fcb是一个**数据结构**，而fb是一个**整数值**。
  - vnc（Virtual Network Computing）是一种远程控制协议：允许用户通过网络访问和控制另一个计算机的桌面。通过VNC，用户可以在一台计算机上实时查看并操作另一台计算机的桌面环境，类似于远程桌面连接。
    >VNC事件源是QEMU在启用VNC服务器时的后台机制，它负责处理鼠标点击、键盘输入等远程操作。这些事件会被传送到虚拟机内部，使用户能够远程控制虚拟机的桌面环境。
  - ppoll 是 Linux 下的一个函数，用于等待文件描述符的状态变化（如可读、可写或出现错误）。
    >ppoll会设置一个最大等待时间
  - qemu主循环中的timeout：
    1. main_loop_wait 中的 timeout：处理定时器事件，确保 QEMU 能够及时响应和执行。
    2. glib_pollfds_fill 中的 timeout：对fd的监听事件，确保 QEMU 在适当的时间内检查是否有 I/O 事件需要处理。
    > 两个 timeout 会相互比较，取较小的一个作为主循环的最大阻塞时间，即主循环在这段时间内最多等待多长时间后必须重新检查事件。
## 2. QEMU线程模型
  1. 一个 QEMU进程代表一个虚拟机。QEMU会有若干个线程，例如：一个CPU会有一个线程、VNC线程、I/O线程等
  > 这里提到的进程和线程都是对应于QEMU宿主机的。
  > 名词解释：
  > BQL： Big QEMU Lock，是 QEMU 用来保护全局状态的一个大锁（big lock）。
  > VNC: Virtual Network Computing是一种远程桌面共享协议和软件，它允许用户通过网络控制和访问另一台计算机的桌面。**在虚拟化平台（如 QEMU）中**，VNC 常用作虚拟机的图形化管理工具。通过 VNC，管理员可以查看和控制虚拟机的桌面界面，方便虚拟机的监控和操作。
  2. QEMU参数解析：
  ```
  typedef struct QEMUOption{
    const char *name;   //参数选项名称
    int flags;          //参数选项属性，比如是否有子参数
    int index;
    uint32_t arch_mask; //参数支持的体系结构
  }QEMUOption;
  ```
  v1.c在全局范围定义了一个 qemu options，不在qemu options 中的参数是不合法的。
